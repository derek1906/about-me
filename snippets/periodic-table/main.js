var list = {"H":{"name":"Hydrogen","number":1,"mass":1.0079,"electronegativity":2.2,"ionizationenergy":13.5984},"He":{"name":"Helium","number":2,"mass":4.0026,"electronegativity":0,"ionizationenergy":24.5874},"Li":{"name":"Lithium","number":3,"mass":6.941,"electronegativity":0.98,"ionizationenergy":5.3917},"Be":{"name":"Beryllium","number":4,"mass":9.0122,"electronegativity":1.57,"ionizationenergy":9.3227},"B":{"name":"Boron","number":5,"mass":10.811,"electronegativity":2.04,"ionizationenergy":8.298},"C":{"name":"Carbon","number":6,"mass":12.0107,"electronegativity":2.55,"ionizationenergy":11.2603},"N":{"name":"Nitrogen","number":7,"mass":14.0067,"electronegativity":3.04,"ionizationenergy":14.5341},"O":{"name":"Oxygen","number":8,"mass":15.9994,"electronegativity":3.44,"ionizationenergy":13.6181},"F":{"name":"Fluorine","number":9,"mass":18.9984,"electronegativity":3.98,"ionizationenergy":17.4228},"Ne":{"name":"Neon","number":10,"mass":20.1797,"electronegativity":0,"ionizationenergy":21.5645},"Na":{"name":"Sodium","number":11,"mass":22.9897,"electronegativity":0.93,"ionizationenergy":5.1391},"Mg":{"name":"Magnesium","number":12,"mass":24.305,"electronegativity":1.31,"ionizationenergy":7.6462},"Al":{"name":"Aluminum","number":13,"mass":26.9815,"electronegativity":1.61,"ionizationenergy":5.9858},"Si":{"name":"Silicon","number":14,"mass":28.0855,"electronegativity":1.9,"ionizationenergy":8.1517},"P":{"name":"Phosphorus","number":15,"mass":30.9738,"electronegativity":2.19,"ionizationenergy":10.4867},"S":{"name":"Sulfur","number":16,"mass":32.065,"electronegativity":2.58,"ionizationenergy":10.36},"Cl":{"name":"Chlorine","number":17,"mass":35.453,"electronegativity":3.16,"ionizationenergy":12.9676},"K":{"name":"Potassium","number":19,"mass":39.0983,"electronegativity":1,"ionizationenergy":4.3407},"Ar":{"name":"Argon","number":18,"mass":39.948,"electronegativity":0,"ionizationenergy":15.7596},"Ca":{"name":"Calcium","number":20,"mass":40.078,"electronegativity":1.36,"ionizationenergy":6.1132},"Sc":{"name":"Scandium","number":21,"mass":44.9559,"electronegativity":1.54,"ionizationenergy":6.5615},"Ti":{"name":"Titanium","number":22,"mass":47.867,"electronegativity":1.63,"ionizationenergy":6.8281},"V":{"name":"Vanadium","number":23,"mass":50.9415,"electronegativity":1.66,"ionizationenergy":6.7462},"Cr":{"name":"Chromium","number":24,"mass":51.9961,"electronegativity":1.55,"ionizationenergy":6.7665},"Mn":{"name":"Manganese","number":25,"mass":54.938,"electronegativity":1.83,"ionizationenergy":7.434},"Fe":{"name":"Iron","number":26,"mass":55.845,"electronegativity":1.88,"ionizationenergy":7.9024},"Ni":{"name":"Nickel","number":28,"mass":58.6934,"electronegativity":1.9,"ionizationenergy":7.6398},"Co":{"name":"Cobalt","number":27,"mass":58.9332,"electronegativity":1.91,"ionizationenergy":7.881},"Cu":{"name":"Copper","number":29,"mass":63.546,"electronegativity":1.65,"ionizationenergy":7.7264},"Zn":{"name":"Zinc","number":30,"mass":65.39,"electronegativity":1.81,"ionizationenergy":9.3942},"Ga":{"name":"Gallium","number":31,"mass":69.723,"electronegativity":2.01,"ionizationenergy":5.9993},"Ge":{"name":"Germanium","number":32,"mass":72.64,"ionizationenergy":7.8994},"As":{"name":"Arsenic","number":33,"mass":74.9216,"electronegativity":2.18,"ionizationenergy":9.7886},"Se":{"name":"Selenium","number":34,"mass":78.96,"electronegativity":2.55,"ionizationenergy":9.7524},"Br":{"name":"Bromine","number":35,"mass":79.904,"ionizationenergy":11.8138},"Kr":{"name":"Krypton","number":36,"mass":83.8,"electronegativity":2.96,"ionizationenergy":13.9996},"Rb":{"name":"Rubidium","number":37,"mass":85.4678,"electronegativity":0,"ionizationenergy":4.1771},"Sr":{"name":"Strontium","number":38,"mass":87.62,"electronegativity":0.82,"ionizationenergy":5.6949},"Y":{"name":"Yttrium","number":39,"mass":88.9059,"electronegativity":0.95,"ionizationenergy":6.2173},"Zr":{"name":"Zirconium","number":40,"mass":91.224,"electronegativity":1.22,"ionizationenergy":6.6339},"Nb":{"name":"Niobium","number":41,"mass":92.9064,"electronegativity":1.33,"ionizationenergy":6.7589},"Mo":{"name":"Molybdenum","number":42,"mass":95.94,"electronegativity":1.6,"ionizationenergy":7.0924},"Tc":{"name":"Technetium","number":43,"mass":98,"electronegativity":2.16,"ionizationenergy":7.28},"Ru":{"name":"Ruthenium","number":44,"mass":101.07,"electronegativity":1.9,"ionizationenergy":7.3605},"Rh":{"name":"Rhodium","number":45,"mass":102.9055,"electronegativity":2.2,"ionizationenergy":7.4589},"Pd":{"name":"Palladium","number":46,"mass":106.42,"electronegativity":2.28,"ionizationenergy":8.3369},"Ag":{"name":"Silver","number":47,"mass":107.8682,"electronegativity":2.2,"ionizationenergy":7.5762},"Cd":{"name":"Cadmium","number":48,"mass":112.411,"electronegativity":1.93,"ionizationenergy":8.9938},"In":{"name":"Indium","number":49,"mass":114.818,"electronegativity":1.69,"ionizationenergy":5.7864},"Tin":{"name":"118.71","number":null,"mass":0,"electronegativity":0,"ionizationenergy":0},"Sn":{"name":"Tin","number":50,"mass":118.71,"electronegativity":1.78,"ionizationenergy":7.3439},"Sb":{"name":"Antimony","number":51,"mass":121.76,"electronegativity":1.96,"ionizationenergy":8.6084},"I":{"name":"Iodine","number":53,"mass":126.9045,"electronegativity":2.05,"ionizationenergy":10.4513},"Te":{"name":"Tellurium","number":52,"mass":127.6,"ionizationenergy":9.0096},"Xe":{"name":"Xenon","number":54,"mass":131.293,"electronegativity":2.1,"ionizationenergy":12.1298},"Cs":{"name":"Cesium","number":55,"mass":132.9055,"electronegativity":2.66,"ionizationenergy":3.8939},"Ba":{"name":"Barium","number":56,"mass":137.327,"electronegativity":2.6,"ionizationenergy":5.2117},"La":{"name":"Lanthanum","number":57,"mass":138.9055,"electronegativity":0.79,"ionizationenergy":5.5769},"Ce":{"name":"Cerium","number":58,"mass":140.116,"electronegativity":0.89,"ionizationenergy":5.5387},"Pr":{"name":"Praseodymium","number":59,"mass":140.9077,"electronegativity":1.1,"ionizationenergy":5.473},"Nd":{"name":"Neodymium","number":60,"mass":144.24,"electronegativity":1.12,"ionizationenergy":5.525},"Pm":{"name":"Promethium","number":61,"mass":145,"electronegativity":1.13,"ionizationenergy":5.582},"Sm":{"name":"Samarium","number":62,"mass":150.36,"electronegativity":1.14,"ionizationenergy":5.6437},"Eu":{"name":"Europium","number":63,"mass":151.964,"electronegativity":0,"ionizationenergy":5.6704},"Gd":{"name":"Gadolinium","number":64,"mass":157.25,"electronegativity":1.17,"ionizationenergy":6.1501},"Tb":{"name":"Terbium","number":65,"mass":158.9253,"electronegativity":0,"ionizationenergy":5.8638},"Dy":{"name":"Dysprosium","number":66,"mass":162.5,"electronegativity":1.2,"ionizationenergy":5.9389},"Ho":{"name":"Holmium","number":67,"mass":164.9303,"electronegativity":0,"ionizationenergy":6.0215},"Er":{"name":"Erbium","number":68,"mass":167.259,"electronegativity":1.22,"ionizationenergy":6.1077},"Tm":{"name":"Thulium","number":69,"mass":168.9342,"electronegativity":1.23,"ionizationenergy":6.1843},"Yb":{"name":"Ytterbium","number":70,"mass":173.04,"electronegativity":1.24,"ionizationenergy":6.2542},"Lu":{"name":"Lutetium","number":71,"mass":174.967,"electronegativity":1.25,"ionizationenergy":5.4259},"Hf":{"name":"Hafnium","number":72,"mass":178.49,"electronegativity":0,"ionizationenergy":6.8251},"Ta":{"name":"Tantalum","number":73,"mass":180.9479,"electronegativity":1.27,"ionizationenergy":7.5496},"W":{"name":"Tungsten","number":74,"mass":183.84,"electronegativity":1.3,"ionizationenergy":7.864},"Re":{"name":"Rhenium","number":75,"mass":186.207,"electronegativity":1.5,"ionizationenergy":7.8335},"Os":{"name":"Osmium","number":76,"mass":190.23,"electronegativity":2.36,"ionizationenergy":8.4382},"Ir":{"name":"Iridium","number":77,"mass":192.217,"electronegativity":1.9,"ionizationenergy":8.967},"Pt":{"name":"Platinum","number":78,"mass":195.078,"electronegativity":2.2,"ionizationenergy":8.9587},"Au":{"name":"Gold","number":79,"mass":196.9665,"electronegativity":2.2,"ionizationenergy":9.2255},"Hg":{"name":"Mercury","number":80,"mass":200.59,"electronegativity":2.28,"ionizationenergy":10.4375},"Tl":{"name":"Thallium","number":81,"mass":204.3833,"electronegativity":2.54,"ionizationenergy":6.1082},"Pb":{"name":"Lead","number":82,"mass":207.2,"electronegativity":2,"ionizationenergy":7.4167},"Bi":{"name":"Bismuth","number":83,"mass":208.9804,"electronegativity":1.62,"ionizationenergy":7.2856},"Po":{"name":"Polonium","number":84,"mass":209,"electronegativity":2.33,"ionizationenergy":8.417},"At":{"name":"Astatine","number":85,"mass":210,"electronegativity":2.02,"ionizationenergy":9.3},"Rn":{"name":"Radon","number":86,"mass":222,"electronegativity":2,"ionizationenergy":10.7485},"Fr":{"name":"Francium","number":87,"mass":223,"electronegativity":2.2,"ionizationenergy":4.0727},"Ra":{"name":"Radium","number":88,"mass":226,"electronegativity":0,"ionizationenergy":5.2784},"Ac":{"name":"Actinium","number":89,"mass":227,"electronegativity":0.7,"ionizationenergy":5.17},"Pa":{"name":"Protactinium","number":91,"mass":231.0359,"electronegativity":1.1,"ionizationenergy":5.89},"Th":{"name":"Thorium","number":90,"mass":232.0381,"electronegativity":0.89,"ionizationenergy":6.3067},"Np":{"name":"Neptunium","number":93,"mass":237,"electronegativity":1.5,"ionizationenergy":6.2657},"U":{"name":"Uranium","number":92,"mass":238.0289,"electronegativity":1.3,"ionizationenergy":6.1941},"Am":{"name":"Americium","number":95,"mass":243,"electronegativity":1.36,"ionizationenergy":5.9738},"Pu":{"name":"Plutonium","number":94,"mass":244,"electronegativity":1.38,"ionizationenergy":6.0262},"Cm":{"name":"Curium","number":96,"mass":247,"electronegativity":1.28,"ionizationenergy":5.9915},"Bk":{"name":"Berkelium","number":97,"mass":247,"electronegativity":1.3,"ionizationenergy":6.1979},"Cf":{"name":"Californium","number":98,"mass":251,"electronegativity":1.3,"ionizationenergy":6.2817},"Es":{"name":"Einsteinium","number":99,"mass":252,"electronegativity":1.3,"ionizationenergy":6.42},"Fm":{"name":"Fermium","number":100,"mass":257,"electronegativity":1.3,"ionizationenergy":6.5},"Md":{"name":"Mendelevium","number":101,"mass":258,"electronegativity":1.3,"ionizationenergy":6.58},"No":{"name":"Nobelium","number":102,"mass":259,"electronegativity":1.3,"ionizationenergy":6.65},"Rf":{"name":"Rutherfordium","number":104,"mass":261,"electronegativity":1.3,"ionizationenergy":0},"Lr":{"name":"Lawrencium","number":103,"mass":262,"electronegativity":1.3,"ionizationenergy":4.9},"Db":{"name":"Dubnium","number":105,"mass":262,"electronegativity":1.3,"ionizationenergy":0},"Bh":{"name":"Bohrium","number":107,"mass":264,"electronegativity":0,"ionizationenergy":0},"Sg":{"name":"Seaborgium","number":106,"mass":266,"electronegativity":0,"ionizationenergy":0},"Mt":{"name":"Meitnerium","number":109,"mass":268,"electronegativity":0,"ionizationenergy":0},"Rg":{"name":"Roentgenium","number":111,"mass":272,"electronegativity":0,"ionizationenergy":0},"Hs":{"name":"Hassium","number":108,"mass":277,"electronegativity":0,"ionizationenergy":0},"Ds":{"name":"Darmstadtium","number":110,"mass":0,"electronegativity":0,"ionizationenergy":0},"Uub":{"name":"Ununbium","number":112,"mass":0,"electronegativity":0,"ionizationenergy":0},"Uut":{"name":"Ununtrium","number":113,"mass":0,"electronegativity":0,"ionizationenergy":0},"Uuq":{"name":"Ununquadium","number":114,"mass":0,"electronegativity":0,"ionizationenergy":0},"Uup":{"name":"Ununpentium","number":115,"mass":0,"electronegativity":0,"ionizationenergy":0},"Uuh":{"name":"Ununhexium","number":116,"mass":0,"electronegativity":0,"ionizationenergy":0},"Uus":{"name":"Ununseptium","number":117,"mass":0,"electronegativity":0,"ionizationenergy":0},"Uuo":{"name":"Ununoctium","number":118,"mass":0,"electronegativity":0,"ionizationenergy":0}};

$(function(){
    $(".element").each(function(i){
        var ele = list[this.innerText];
        if(ele !== undefined){
            $("a", this).attr({
                href: "http://en.wikipedia.org/wiki/" + ele.name,
                target: "_blank",
                class: "elementLink"
            }).click(function(e){
                e.stopPropagation();
            });
            $(this).attr({
                name: this.innerText
            }).data({
                abbr: this.innerText,
                name: ele.name,
                number: ele.number,
                mass: ele.mass,
                electronegativity: ele.electronegativity,
                ionizationenergy: ele.ionizationenergy
            }).prepend(
                $("<div>").addClass("number").text(ele.number)
            ).append(
                $("<span>").addClass("info").append(
                    $("<div>").addClass("name").text(ele.name),
                    $("<div>").addClass("mass show").text(addZeros(ele.mass, 4) || "-"),
                    $("<div>").addClass("electronegativity").text(ele.electronegativity || "-"),
                    $("<div>").addClass("ionizationenergy").text(ele.ionizationenergy || "-")
                )
            );
        }
    });
    $(window).resize(function(){
        $(".element").css({
            width: ($(this).width() - 16 - 30)/19
        });
    }).trigger("resize");
    
    (function(callback){
        $("#highlight").on(navigator.userAgent.match(/(iPad|iPhone|iPod)/g) ? "blur" : "input", callback).focus(function(){
            var ele = this;
            setTimeout(function(){
                ele.select();
            }, 0);
        }).on("keydown", function(e){
            if(e.keyCode == 13){
                this.blur();
                callback.apply(this);
                e.stopPropagation();
                e.preventDefault();
            }
        });
    })(function(){
        var ele = this,
            query = ele.value.split(/[,\s]/);
        $(".element").removeClass("highlight");
        $.each(query, function(){
            var q = this.toLowerCase();
            $(".element").filter(function(){
                return $(this).data("name").toLowerCase() == q || $(this).data("abbr").toLowerCase() == q || $(this).data("number") == q;
            }).addClass("highlight");
        });
    });
    
    $("#display > button").click(function(e){
        $(".info > div").removeClass("show").filter("." + this.id).addClass("show");
        $("#display > button").removeClass("btn-primary").filter(this).addClass("btn-primary");
        e.preventDefault();
    });
    
    $(".element").click(function(){
        $(this).toggleClass("userHighlighted");
    });
    
    $("#calmass").click(function(e){
        var form = $("<form>"),
            div = $("<div class='form-group'>").appendTo(form).append(
                $("<label>").text("Enter molecular formula: (Use proper capitalization)")
            ),
            inputArea = $("<input>").attr("type", "text").addClass("form-control").attr("placeholder", "Enter molecular formula...").appendTo(div),
            icon = gly("warning-sign").addClass("form-control-feedback").appendTo(div).hide(),
            result = $("<div>").appendTo(form).attr("id", "massMath").css("text-align", "center");
        createModal({
            title: "Analyze Molecule",
            content: form,
            backdrop: "static",
            onShown: function(){
                inputArea.focus();
            }
        });

        inputArea.on("input", function(){
            div.removeClass("has-warning has-feedback");
            icon.hide();
            result.empty();
            if(!this.value.length){
                return false;
            }
            var formula = this.value.replace(/\s/g, "").split(/(?=[A-Z]+)/),
                total = {mass: 0, e: 0, hasTransit: false},
                hasError = false;
            $.each(formula, function(){
                var ele = this.match(/\D+/)[0],
                    amount = this.match(/\d+/);
                amount = amount === null ? 1 : amount[0];
                if(!list[ele] || !/^[A-Z]([a-z])?\d*$/.test(this)){
                    result.text("Invalid formula! (Can't interpret \"" + this + "\")");
                    div.addClass("has-warning has-feedback");
                    icon.show();
                    hasError = true;
                    return false;
                }
                total.mass += list[ele].mass * amount;
                if(
                    (list[ele].number >= 21 && list[ele].number <= 30) ||
                    (list[ele].number >= 39 && list[ele].number <= 48) ||
                    (list[ele].number >= 57 && list[ele].number <= 80) ||
                    (list[ele].number >= 89 && list[ele].number <= 112)
                ){
                    total.hasTransit = true;
                }else if(/^(1|3|11|19|37|55|87)$/.test(list[ele].number)){
                    total.e += 1 * amount;
                }else if(/^(2|4|12|20|38|56|88)$/.test(list[ele].number)){
                    total.e += 2 * amount;
                }else if(/^(5|13|31|49|81|113)$/.test(list[ele].number)){
                    total.e += 3 * amount;
                }else if(/^(6|14|32|50|82|114)$/.test(list[ele].number)){
                    total.e += 4 * amount;
                }else if(/^(7|15|33|51|83|115)$/.test(list[ele].number)){
                    total.e += 5 * amount;
                }else if(/^(8|16|34|52|84|116)$/.test(list[ele].number)){
                    total.e += 6 * amount;
                }else if(/^(9|17|35|53|85|117)$/.test(list[ele].number)){
                    total.e += 7 * amount;
                }else if(/^(10|18|36|54|86|118)$/.test(list[ele].number)){
                    total.e += 8 * amount;
                }
                //total.e += list[ele].number * amount;
            });
            if(hasError) return false;
            total.mass = Math.round(total.mass*1000)/1000;
            MathJax.Hub.Typeset();
            var math = $("<script>").attr("type", "math/tex").html(
                "\\text{Mass of }" + formula.join("").replace(/(\d+)/g, "_{$1}") + ": " + total.mass + "\\frac{g}{mol}"
            ).appendTo(result);
            $("<div>").text("Number of valence electrons: " + (total.hasTransit ? "Can't determine" : total.e)).appendTo(result);
            MathJax.Hub.Queue(["Reprocess", MathJax.Hub, math[0]]);
        });
        e.preventDefault();
    });
});